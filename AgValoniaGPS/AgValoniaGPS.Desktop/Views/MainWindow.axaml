<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:AgValoniaGPS.ViewModels"
        xmlns:controls="using:AgValoniaGPS.Desktop.Controls"
        xmlns:panelsFieldMgmt="using:AgValoniaGPS.Desktop.Views.Panels.FieldManagement"
        xmlns:panelsDisplay="using:AgValoniaGPS.Desktop.Views.Panels.Display"
        xmlns:panelsFieldOps="using:AgValoniaGPS.Desktop.Views.Panels.FieldOperations"
        xmlns:panelsGuidance="using:AgValoniaGPS.Desktop.Views.Panels.Guidance"
        xmlns:panelsConfig="using:AgValoniaGPS.Desktop.Views.Panels.Configuration"
        mc:Ignorable="d" d:DesignWidth="1366" d:DesignHeight="768"
        x:Class="AgValoniaGPS.Desktop.Views.MainWindow"
        x:DataType="vm:MainViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="AgValoniaGPS"
        Width="1366" Height="768"
        WindowState="Maximized"
        Background="#1a1a1a">

    <Window.Styles>
        <!-- Floating Panel Style -->
        <Style Selector="Border.FloatingPanel">
            <Setter Property="Background" Value="#DD2C3E50"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="15"/>
            <Setter Property="BoxShadow" Value="0 4 16 2 #40000000"/>
        </Style>

        <!-- Modern Button Style -->
        <Style Selector="Button.ModernButton">
            <Setter Property="Background" Value="#3498DB"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        <Style Selector="Button.ModernButton:pointerover">
            <Setter Property="Background" Value="#2980B9"/>
        </Style>
        <Style Selector="Button.ModernButton:pressed">
            <Setter Property="Background" Value="#21618C"/>
        </Style>

        <!-- Icon Button Style -->
        <Style Selector="Button.IconButton">
            <Setter Property="Background" Value="#DD34495E"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Width" Value="48"/>
            <Setter Property="Height" Value="48"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="20"/>
        </Style>
        <Style Selector="Button.IconButton:pointerover">
            <Setter Property="Background" Value="#DD475A6E"/>
        </Style>

        <!-- Status Indicator Style -->
        <Style Selector="Border.StatusBox">
            <Setter Property="Background" Value="#DD1E2930"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="10"/>
        </Style>
    </Window.Styles>

    <!-- Main Grid with OpenGL as background -->
    <Grid>
        <!-- OpenGL Map Render Area (fills entire window) -->
        <controls:OpenGLMapControl x:Name="MapControl" ZIndex="0" />

        <!-- Transparent overlay to capture mouse events for OpenGL control -->
        <Panel ZIndex="1" Background="Transparent"
               PointerPressed="MapOverlay_PointerPressed"
               PointerMoved="MapOverlay_PointerMoved"
               PointerReleased="MapOverlay_PointerReleased"
               PointerWheelChanged="MapOverlay_PointerWheelChanged" />

        <!-- TOP STATUS BAR: RTK Status -->
        <Border Classes="FloatingPanel"
                ZIndex="10"
                Margin="20"
                HorizontalAlignment="Left"
                VerticalAlignment="Top"
                IsHitTestVisible="True">
            <StackPanel Orientation="Horizontal" Spacing="10">
                <TextBlock Text="RTK Status" Foreground="#3498DB" FontSize="14" FontWeight="Bold"/>
                <Ellipse Width="12" Height="12"
                         Fill="{Binding FixQuality, Converter={StaticResource FixQualityToColorConverter}}"/>
                <TextBlock Text="{Binding FixQuality}" Foreground="White" FontSize="14" FontWeight="Bold"/>
            </StackPanel>
        </Border>

        <!-- TOP-RIGHT PANEL: Quick Actions -->
        <Border Classes="FloatingPanel"
                ZIndex="10"
                Margin="20"
                HorizontalAlignment="Right"
                VerticalAlignment="Top"
                IsHitTestVisible="True">
            <StackPanel Spacing="8">
                <!-- GPS Status Button (shows fix quality color) -->
                <Button Width="48" Height="48"
                        CornerRadius="8"
                        Padding="0"
                        BorderThickness="0"
                        Background="{Binding FixQuality, Converter={StaticResource FixQualityToColorConverter}}"
                        ToolTip.Tip="Data I/O Configuration"
                        Click="BtnDataIO_Click">
                    <TextBlock Text="GPS" FontSize="12" FontWeight="Bold" Foreground="Black"/>
                </Button>

                <Separator Height="1" Background="#444" Margin="4,4"/>
                <Button Classes="IconButton" Content="âš™ï¸" ToolTip.Tip="Settings - Wave 8 Services" Click="BtnSettings_Click"/>
                <Button Classes="IconButton" Content="ðŸ“" ToolTip.Tip="Fields" Click="BtnFields_Click"/>
                <Button Classes="IconButton" Content="ðŸŽ¬" ToolTip.Tip="Toggle 2D/3D View (F3)" Click="Btn3DToggle_Click"/>
                <Separator Height="1" Background="#444" Margin="4,4"/>
                <Button Classes="IconButton" Content="+" ToolTip.Tip="Zoom In"/>
                <Button Classes="IconButton" Content="-" ToolTip.Tip="Zoom Out"/>
            </StackPanel>
        </Border>

        <!-- LEFT SIDEBAR: Navigation Menu (vertical) -->
        <Border Classes="FloatingPanel"
                ZIndex="10"
                Margin="20"
                HorizontalAlignment="Left"
                VerticalAlignment="Center"
                IsHitTestVisible="True">
            <StackPanel Spacing="8">
                <Button Classes="IconButton" Content="ðŸ—ºï¸" ToolTip.Tip="Display"/>
                <Button Classes="IconButton" Content="ðŸ”§" ToolTip.Tip="Config"/>
                <Button Classes="IconButton" Content="ðŸ“" ToolTip.Tip="Boundaries"/>
                <Button Classes="IconButton" Content="ðŸšœ" ToolTip.Tip="Vehicle"/>
            </StackPanel>
        </Border>

        <!-- PANEL TOGGLES: Show/Hide Wave 10 Panels -->
        <Border Classes="FloatingPanel"
                ZIndex="10"
                Margin="20,20,20,200"
                HorizontalAlignment="Left"
                VerticalAlignment="Bottom"
                MaxWidth="250"
                IsHitTestVisible="True">
            <ScrollViewer MaxHeight="500">
                <StackPanel Spacing="4">
                    <TextBlock Text="PANELS" Foreground="#3498DB" FontSize="12" FontWeight="Bold" Margin="0,0,0,6"/>

                    <!-- Task Group 1: Core Operations -->
                    <Button Classes="ModernButton" Content="Field Data" FontSize="11" Padding="8,4"
                            Command="{Binding ToggleFieldDataPanelCommand}"
                            Background="{Binding IsFieldDataPanelVisible, Converter={StaticResource BoolToColorConverter}}"/>
                    <Button Classes="ModernButton" Content="GPS Data" FontSize="11" Padding="8,4"
                            Command="{Binding ToggleGPSDataPanelCommand}"
                            Background="{Binding IsGPSDataPanelVisible, Converter={StaticResource BoolToColorConverter}}"/>
                    <Button Classes="ModernButton" Content="Tram Lines" FontSize="11" Padding="8,4"
                            Command="{Binding ToggleTramLinePanelCommand}"
                            Background="{Binding IsTramLinePanelVisible, Converter={StaticResource BoolToColorConverter}}"/>
                    <Button Classes="ModernButton" Content="Quick A-B" FontSize="11" Padding="8,4"
                            Command="{Binding ToggleQuickABPanelCommand}"
                            Background="{Binding IsQuickABPanelVisible, Converter={StaticResource BoolToColorConverter}}"/>

                    <Separator Height="1" Background="#444" Margin="0,4"/>

                    <!-- Task Group 2: Configuration -->
                    <Button Classes="ModernButton" Content="Steering Config" FontSize="11" Padding="8,4"
                            Command="{Binding ToggleSteerConfigPanelCommand}"
                            Background="{Binding IsSteerConfigPanelVisible, Converter={StaticResource BoolToColorConverter}}"/>
                    <Button Classes="ModernButton" Content="General Config" FontSize="11" Padding="8,4"
                            Command="{Binding ToggleGeneralConfigPanelCommand}"
                            Background="{Binding IsGeneralConfigPanelVisible, Converter={StaticResource BoolToColorConverter}}"/>
                    <Button Classes="ModernButton" Content="Diagnostics" FontSize="11" Padding="8,4"
                            Command="{Binding ToggleDiagnosticsPanelCommand}"
                            Background="{Binding IsDiagnosticsPanelVisible, Converter={StaticResource BoolToColorConverter}}"/>
                    <Button Classes="ModernButton" Content="Roll Correction" FontSize="11" Padding="8,4"
                            Command="{Binding ToggleRollCorrectionPanelCommand}"
                            Background="{Binding IsRollCorrectionPanelVisible, Converter={StaticResource BoolToColorConverter}}"/>
                    <Button Classes="ModernButton" Content="Vehicle Config" FontSize="11" Padding="8,4"
                            Command="{Binding ToggleVehicleConfigPanelCommand}"
                            Background="{Binding IsVehicleConfigPanelVisible, Converter={StaticResource BoolToColorConverter}}"/>

                    <Separator Height="1" Background="#444" Margin="0,4"/>

                    <!-- Task Group 3: Field Management -->
                    <Button Classes="ModernButton" Content="Flags" FontSize="11" Padding="8,4"
                            Command="{Binding ToggleFlagsPanelCommand}"
                            Background="{Binding IsFlagsPanelVisible, Converter={StaticResource BoolToColorConverter}}"/>
                    <Button Classes="ModernButton" Content="Camera" FontSize="11" Padding="8,4"
                            Command="{Binding ToggleCameraPanelCommand}"
                            Background="{Binding IsCameraPanelVisible, Converter={StaticResource BoolToColorConverter}}"/>
                    <Button Classes="ModernButton" Content="Boundary Editor" FontSize="11" Padding="8,4"
                            Command="{Binding ToggleBoundaryEditorPanelCommand}"
                            Background="{Binding IsBoundaryEditorPanelVisible, Converter={StaticResource BoolToColorConverter}}"/>
                    <Button Classes="ModernButton" Content="Field Tools" FontSize="11" Padding="8,4"
                            Command="{Binding ToggleFieldToolsPanelCommand}"
                            Background="{Binding IsFieldToolsPanelVisible, Converter={StaticResource BoolToColorConverter}}"/>
                    <Button Classes="ModernButton" Content="Field Files" FontSize="11" Padding="8,4"
                            Command="{Binding ToggleFieldFileManagerPanelCommand}"
                            Background="{Binding IsFieldFileManagerPanelVisible, Converter={StaticResource BoolToColorConverter}}"/>
                </StackPanel>
            </ScrollViewer>
        </Border>

        <!-- BOTTOM BAR: Function Buttons (horizontal) -->
        <Border Classes="FloatingPanel"
                ZIndex="10"
                Margin="20"
                HorizontalAlignment="Center"
                VerticalAlignment="Bottom"
                IsHitTestVisible="True">
            <StackPanel Orientation="Horizontal" Spacing="8">
                <Button Classes="ModernButton" Content="ðŸŽ¯ Auto" Width="80"/>
                <Button Classes="ModernButton" Content="ðŸ“ Mark" Width="80"/>
                <Button Classes="ModernButton" Content="ðŸ”„ Reset" Width="80"/>
            </StackPanel>
        </Border>

        <!-- Draggable Section Control (using Canvas for absolute positioning) -->
        <Canvas ZIndex="10">
        <Border x:Name="SectionControlPanel"
                Canvas.Left="900" Canvas.Top="600"
                Classes="FloatingPanel"
                Cursor="Hand"
                PointerPressed="SectionControl_PointerPressed"
                PointerMoved="SectionControl_PointerMoved"
                PointerReleased="SectionControl_PointerReleased">
            <StackPanel Orientation="Horizontal" Spacing="6">
                <TextBlock Text="â‰¡" Foreground="#888" FontSize="16" FontWeight="Bold"
                           VerticalAlignment="Center" Margin="0,0,4,0" ToolTip.Tip="Drag to move"/>
                <TextBlock Text="Sections" Foreground="White" FontSize="12" FontWeight="Bold"
                           VerticalAlignment="Center" Margin="0,0,8,0"/>

                <!-- Section Buttons in single horizontal row -->
                <StackPanel Orientation="Horizontal" Spacing="4">
                    <Border Background="#E74C3C" CornerRadius="4" Height="32" Width="45">
                        <TextBlock Text="1" HorizontalAlignment="Center" VerticalAlignment="Center"
                                   Foreground="White" FontWeight="Bold" FontSize="14"/>
                    </Border>
                    <Border Background="#E74C3C" CornerRadius="4" Height="32" Width="45">
                        <TextBlock Text="2" HorizontalAlignment="Center" VerticalAlignment="Center"
                                   Foreground="White" FontWeight="Bold" FontSize="14"/>
                    </Border>
                    <Border Background="#E74C3C" CornerRadius="4" Height="32" Width="45">
                        <TextBlock Text="3" HorizontalAlignment="Center" VerticalAlignment="Center"
                                   Foreground="White" FontWeight="Bold" FontSize="14"/>
                    </Border>
                    <Border Background="#E74C3C" CornerRadius="4" Height="32" Width="45">
                        <TextBlock Text="4" HorizontalAlignment="Center" VerticalAlignment="Center"
                                   Foreground="White" FontWeight="Bold" FontSize="14"/>
                    </Border>
                    <Border Background="#E74C3C" CornerRadius="4" Height="32" Width="45">
                        <TextBlock Text="5" HorizontalAlignment="Center" VerticalAlignment="Center"
                                   Foreground="White" FontWeight="Bold" FontSize="14"/>
                    </Border>
                    <Border Background="#E74C3C" CornerRadius="4" Height="32" Width="45">
                        <TextBlock Text="6" HorizontalAlignment="Center" VerticalAlignment="Center"
                                   Foreground="White" FontWeight="Bold" FontSize="14"/>
                    </Border>
                </StackPanel>
            </StackPanel>
        </Border>
        </Canvas>

        <!-- ========== WAVE 10 OPERATIONAL PANELS ========== -->

        <!-- Task Group 1: Core Operations Panels -->
        <panelsFieldMgmt:FormFieldData
            IsVisible="{Binding IsFieldDataPanelVisible}"
            HorizontalAlignment="Right"
            VerticalAlignment="Top"
            Margin="200,20,20,20"
            ZIndex="15" />

        <panelsDisplay:FormGPSData
            IsVisible="{Binding IsGPSDataPanelVisible}"
            HorizontalAlignment="Right"
            VerticalAlignment="Top"
            Margin="200,100,20,20"
            ZIndex="15" />

        <panelsFieldOps:FormTramLine
            IsVisible="{Binding IsTramLinePanelVisible}"
            HorizontalAlignment="Right"
            VerticalAlignment="Top"
            Margin="200,180,20,20"
            ZIndex="15" />

        <panelsGuidance:FormQuickAB
            IsVisible="{Binding IsQuickABPanelVisible}"
            HorizontalAlignment="Right"
            VerticalAlignment="Top"
            Margin="200,260,20,20"
            ZIndex="15" />

        <!-- Task Group 2: Configuration Panels -->
        <panelsConfig:FormSteer
            IsVisible="{Binding IsSteerConfigPanelVisible}"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            ZIndex="15" />

        <panelsConfig:FormConfig
            IsVisible="{Binding IsGeneralConfigPanelVisible}"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            ZIndex="15" />

        <panelsConfig:FormDiagnostics
            IsVisible="{Binding IsDiagnosticsPanelVisible}"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            ZIndex="15" />

        <panelsConfig:FormRollCorrection
            IsVisible="{Binding IsRollCorrectionPanelVisible}"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            ZIndex="15" />

        <panelsConfig:FormVehicleConfig
            IsVisible="{Binding IsVehicleConfigPanelVisible}"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            ZIndex="15" />

        <!-- Task Group 3: Field Management Panels -->
        <panelsFieldMgmt:FormFlags
            IsVisible="{Binding IsFlagsPanelVisible}"
            HorizontalAlignment="Left"
            VerticalAlignment="Top"
            Margin="200,20,20,20"
            ZIndex="15" />

        <panelsFieldMgmt:FormCamera
            IsVisible="{Binding IsCameraPanelVisible}"
            HorizontalAlignment="Left"
            VerticalAlignment="Top"
            Margin="200,100,20,20"
            ZIndex="15" />

        <panelsFieldMgmt:FormBoundaryEditor
            IsVisible="{Binding IsBoundaryEditorPanelVisible}"
            HorizontalAlignment="Left"
            VerticalAlignment="Top"
            Margin="200,180,20,20"
            ZIndex="15" />

        <panelsFieldMgmt:FormFieldTools
            IsVisible="{Binding IsFieldToolsPanelVisible}"
            HorizontalAlignment="Left"
            VerticalAlignment="Top"
            Margin="200,260,20,20"
            ZIndex="15" />

        <panelsFieldMgmt:FormFieldFileManager
            IsVisible="{Binding IsFieldFileManagerPanelVisible}"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            ZIndex="15" />

    </Grid>
</Window>
