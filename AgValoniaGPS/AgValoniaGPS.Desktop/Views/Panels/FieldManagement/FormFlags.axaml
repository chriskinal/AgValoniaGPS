<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:AgValoniaGPS.ViewModels.Panels.FieldManagement"
             x:Class="AgValoniaGPS.Desktop.Views.Panels.FieldManagement.FormFlags"
             x:DataType="vm:FormFlagsViewModel">

    <Border Classes="FloatingPanel" Width="300" MinHeight="400">
        <StackPanel Spacing="15">
            <!-- Header -->
            <Grid Height="32" Margin="0,0,0,8">
                <!-- Drag handle and title -->
                <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                    <TextBlock Text="≡" Foreground="#888" FontSize="16" FontWeight="Bold"
                               VerticalAlignment="Center" ToolTip.Tip="Drag to move panel"/>
                    <TextBlock Text="{Binding Title}"
                               FontWeight="Bold"
                               FontSize="18"
                               Foreground="White"
                               VerticalAlignment="Center"/>
                </StackPanel>
                <!-- Close button (absolutely positioned in top-right) -->
                <Button Classes="IconButton"
                        Content="×"
                        Width="32"
                        Height="32"
                        FontSize="20"
                        Command="{Binding CloseCommand}"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Top"/>
            </Grid>

            <!-- Flags List -->
            <Border Classes="StatusBox">
                <StackPanel Spacing="8">
                    <TextBlock Text="Field Flags" Foreground="#AAA" FontSize="12"/>
                    <ListBox ItemsSource="{Binding Flags}"
                             SelectedItem="{Binding SelectedFlag}"
                             Height="250"
                             Background="#222"
                             BorderBrush="#444"
                             BorderThickness="1">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Spacing="10" Margin="5">
                                    <Border Width="16" Height="16" CornerRadius="8"
                                            Background="{Binding ColorHex}"/>
                                    <TextBlock Text="{Binding Name}"
                                               Foreground="White"
                                               VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding DateCreated, StringFormat='HH:mm:ss'}"
                                               Foreground="Gray"
                                               VerticalAlignment="Center"
                                               FontSize="11"/>
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </StackPanel>
            </Border>

            <!-- Action Buttons -->
            <StackPanel Spacing="8">
                <Button Classes="ModernButton"
                        Content="Add Flag at Current Position"
                        Command="{Binding AddFlagCommand}"
                        HorizontalAlignment="Stretch"
                        Height="40"
                        Background="#27AE60"/>

                <StackPanel Orientation="Horizontal" Spacing="8">
                    <Button Classes="ModernButton"
                            Content="Edit"
                            Command="{Binding EditFlagCommand}"
                            Width="90"
                            Height="35"
                            Background="#3498DB"/>
                    <Button Classes="ModernButton"
                            Content="Delete"
                            Command="{Binding DeleteFlagCommand}"
                            Width="90"
                            Height="35"
                            Background="#E67E22"/>
                    <Button Classes="ModernButton"
                            Content="Clear All"
                            Command="{Binding ClearAllFlagsCommand}"
                            Width="90"
                            Height="35"
                            Background="#E74C3C"/>
                </StackPanel>
            </StackPanel>

            <!-- Error Message -->
            <Border Classes="StatusBox"
                    Background="#99E74C3C"
                    IsVisible="{Binding HasError}">
                <TextBlock Text="{Binding ErrorMessage}"
                           Foreground="White"
                           FontSize="12"
                           TextWrapping="Wrap"/>
            </Border>
        </StackPanel>
    </Border>
</UserControl>
