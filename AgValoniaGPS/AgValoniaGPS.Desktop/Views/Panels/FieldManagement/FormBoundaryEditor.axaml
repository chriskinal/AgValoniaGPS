<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:AgValoniaGPS.ViewModels.Panels.FieldManagement"
             x:Class="AgValoniaGPS.Desktop.Views.Panels.FieldManagement.FormBoundaryEditor"
             x:DataType="vm:FormBoundaryEditorViewModel">

    <Border Classes="FloatingPanel" Width="320" MinHeight="450">
        <StackPanel Spacing="15">
            <!-- Header -->
            <DockPanel>
                <TextBlock Text="{Binding Title}"
                           FontWeight="Bold"
                           FontSize="18"
                           Foreground="White"
                           DockPanel.Dock="Left"/>
                <Button Classes="IconButton"
                        Content="Ã—"
                        Width="32"
                        Height="32"
                        FontSize="20"
                        Command="{Binding CloseCommand}"
                        DockPanel.Dock="Right"/>
            </DockPanel>

            <!-- Drawing Mode Status -->
            <Border Classes="StatusBox">
                <StackPanel Spacing="5">
                    <TextBlock Text="Drawing Mode"
                               Foreground="White"
                               FontSize="12"
                               FontWeight="Bold"
                               HorizontalAlignment="Center"/>
                    <TextBlock Text="{Binding IsDrawingMode}"
                               Foreground="White"
                               FontSize="14"
                               HorizontalAlignment="Center"/>
                </StackPanel>
            </Border>

            <!-- Boundary Statistics -->
            <Border Classes="StatusBox">
                <StackPanel Spacing="8">
                    <TextBlock Text="Boundary Info" Foreground="#AAA" FontSize="12"/>
                    <Grid ColumnDefinitions="*,Auto">
                        <TextBlock Text="Points:" Foreground="#CCC" Grid.Column="0"/>
                        <TextBlock Text="{Binding PointCount}" Foreground="White" Grid.Column="1"/>
                    </Grid>
                    <Grid ColumnDefinitions="*,Auto">
                        <TextBlock Text="Area (ha):" Foreground="#CCC" Grid.Column="0"/>
                        <TextBlock Text="{Binding BoundaryAreaHectares, StringFormat='F2'}" Foreground="White" Grid.Column="1"/>
                    </Grid>
                </StackPanel>
            </Border>

            <!-- Drawing Controls -->
            <Border Classes="StatusBox">
                <StackPanel Spacing="8">
                    <TextBlock Text="Drawing" Foreground="#AAA" FontSize="12"/>

                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <Button Classes="ModernButton"
                                Content="Start"
                                Command="{Binding StartDrawingCommand}"
                                Width="90"
                                Height="35"
                                Background="#27AE60"/>
                        <Button Classes="ModernButton"
                                Content="Stop"
                                Command="{Binding StopDrawingCommand}"
                                Width="90"
                                Height="35"
                                Background="#E67E22"/>
                    </StackPanel>

                    <Button Classes="ModernButton"
                            Content="Add Point at Current Position"
                            Command="{Binding AddPointCommand}"
                            HorizontalAlignment="Stretch"
                            Height="40"
                            Background="#3498DB"/>

                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <Button Classes="ModernButton"
                                Content="Undo Point"
                                Command="{Binding UndoLastPointCommand}"
                                Width="140"
                                Height="35"/>
                        <Button Classes="ModernButton"
                                Content="Clear"
                                Command="{Binding ClearBoundaryCommand}"
                                Width="140"
                                Height="35"
                                Background="#E74C3C"/>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Simplification -->
            <Border Classes="StatusBox">
                <StackPanel Spacing="8">
                    <TextBlock Text="Simplification" Foreground="#AAA" FontSize="12"/>

                    <StackPanel Spacing="4">
                        <TextBlock Text="Tolerance (meters)" Foreground="#CCC" FontSize="12"/>
                        <NumericUpDown Value="{Binding SimplificationTolerance}"
                                       Minimum="0.1"
                                       Maximum="10"
                                       Increment="0.1"
                                       FormatString="F1"
                                       HorizontalAlignment="Stretch"/>
                    </StackPanel>

                    <Button Classes="ModernButton"
                            Content="Simplify Boundary"
                            Command="{Binding SimplifyBoundaryCommand}"
                            HorizontalAlignment="Stretch"
                            Height="35"
                            Background="#9B59B6"/>
                </StackPanel>
            </Border>

            <!-- Save Button -->
            <Button Classes="ModernButton"
                    Content="Save Boundary"
                    Command="{Binding SaveBoundaryCommand}"
                    HorizontalAlignment="Stretch"
                    Height="45"
                    Background="#27AE60"
                    FontSize="16"
                    FontWeight="Bold"/>

            <!-- Error Message -->
            <Border Classes="StatusBox"
                    Background="#99E74C3C"
                    IsVisible="{Binding HasError}">
                <TextBlock Text="{Binding ErrorMessage}"
                           Foreground="White"
                           FontSize="12"
                           TextWrapping="Wrap"/>
            </Border>
        </StackPanel>
    </Border>
</UserControl>
